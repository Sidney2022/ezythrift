{% extends 'main/base.html' %}
{% load static %}
{% block content %}
<div class="breadcrumb-area">
    <div class="container">
        <div class="breadcrumb-content">
            <ul>
                <li><a href="{% url 'homepage' %}">Home</a></li>
                <li class="active">Checkout</li>
            </ul>
        </div>
    </div>
</div>
<!-- Li's Breadcrumb Area End Here -->
<!--Checkout Area Strat-->
<div class="checkout-area pt-60 pb-30">
    <div class="container">
        <div class="row">
          
        </div>
        <div class="row">
            <div class="col-lg-6 col-12">
                <div>
                    <h4>Your delivery address is currently set to 
                    </h4>
                    <ul class="py-3" style="font-size:20px; text-transform:capitalize;">
                        <li> {{user.address}},  {{user.apartment}}, </li>
                        <li> {{user.city}}, {{user.state}},  </li>
                        <li> {{user.country}}  </li>

                    </ul>

                </div>
                <div class="different-address">
                    <div class="ship-different-title">
                            <p>Ship to a different address? 
                            <a href="{% url 'account' %}" > change you shipping info here </a>
                        </p>
                    </div>
                    
                    {% comment %} <div class="order-notes">
                        <div class="checkout-form-list">
                            <label>Order Notes</label>
                            <textarea id="checkout-mess" cols="30" rows="10" placeholder="Notes about your order, e.g. special notes for delivery."></textarea>
                        </div>
                    </div> {% endcomment %}
                </div>
            </div>
            <div class="col-lg-6 col-12">
                <div class="your-order">
                    <h3>Your order</h3>
                    <div class="your-order-table table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="cart-product-name">Product</th>
                                    <th class="cart-product-total">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in cart_items %}
                                <tr class="cart_item">
                                    <td class="cart-product-name"> {{item.product.name}} <strong class="product-quantity"> × {{item.number_of_items}} </strong></td>
                                    <td class="cart-product-total"><span class="amount">£165.00</span></td>  
                                </tr>
                                {% endfor %}
                            </tbody>
                            <tfoot>
                                <tr class="cart-subtotal">
                                    <th>Cart Subtotal</th>
                                    <td><span class="amount">£</span></td>
                                </tr>
                                <tr class="order-total">
                                    <th>Grand Total</th>
                                    <td><strong><span class="amount">£{{order_amt}}</span></strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="payment-method">
                        <div class="payment-accordion">
                            
                            <div class="order-button-payment">
                                {% comment %} <input value="Place order" type="submit"> {% endcomment %}
                                <a class="btn btn-success" href="{% url 'payment' %}" > Pay Now </a>
                                {% comment %} <button  class="btn btn-dark" onclick="payWithPaystack()"> Pay Now</button> {% endcomment %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
    function payWithPaystack() {
        const first_name= "{{user.first_name}}"
        const last_name= "{{user.last_name}}"
        const email= "{{user.email}}"
        const amt = {{order_amt}} * 100
        console.log(typeof(amt), amt)
        let handler = PaystackPop.setup({
          key: 'pk_test_80ce0931ea2340cedcc210e22b23b973a0397752', // Replace with your public key
          email: `${email}`,
          amount: amt,
        //  currency: 'NGN',
          channels: ['card'],
          ref: ''+Math.floor((Math.random() * 1000000000) + 1), // generates a pseudo-unique reference. Please replace with a reference you generated. Or remove the line entirely so our API will generate one for you
          // label: "Optional string that replaces customer email"
          onClose: function(){
            alert('Window closed.');
          },
          callback: function(response){
            let message = 'Payment complete! Reference: ' + response.reference;
            alert(message);
            //here, make request to create order, redirect user to another page
            window.location = "/place-order"
          }
        });
      
        handler.openIframe();
      }
    </script>

{% endblock %}